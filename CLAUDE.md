# Journal Agent - 量化日记系统

## 项目愿景
这是一个面向商业化的 AI 增强型个人量化日记系统。
构建一个 本地优先 (Local-First) 的个人管理系统。通过 Streamlit 界面进行每日的 任务管理、时间颗粒度记录 和 日记反思。
核心目标是解决 “晚间复盘盲区”（无法记录当晚数据）的问题，并实现数据结构化存储以便于 AI 后期分析，同时生成人类可读的 Markdown 文件作为永久存档。
当前阶段：完善核心功能，确保稳定性和用户体验。
最终目标：发展为可商业化的产品/SaaS 服务。

## 技术栈
- 语言：Python 3.x
- Web 框架：Streamlit
- 数据处理：Pandas
- 数据存储：CSV（原始数据）+ Markdown（成品输出）
- 启动方式：`streamlit run app.py`

## 项目结构
```
journal_agnet/
├── app.py                    # Streamlit 入口
├── core/                     # 所有业务模块
│   ├── __init__.py
│   ├── config.py             # 路径配置，基础目录定义
│   ├── data_manager.py       # 核心数据处理，CSV 读写和 Markdown 生成
│   ├── texts.py              # UI 文案、评分定义、坏习惯关键词库
│   ├── template.py           # 日程模板，48 个时间段的默认安排
│   └── md_template.py        # Markdown 日记模板生成器
├── assets/
│   └── styles.css            # Streamlit 自定义样式
├── docs/                     # 项目文档
├── tests/                    # 测试目录
├── CLAUDE.md
├── .gitignore
└── 启动日记.bat
```

## 核心功能模块

### 模块 A：侧边栏日期导航
- 动态生成日期列表：明天（规划）→ 今天（执行）→ 过去6天（补录）
- 选择日期后主界面刷新，从 CSV 加载该日数据
- 无数据时自动创建空模板（时间表从 `template.py` 填充默认计划）
- 日记编号系统：以 2026-02-18 = No.1100 为锚点，按日期差值递推

### 模块 B：主界面工作流（三个区域）

**1. 任务看板（Tab: 任务清单）**
- `st.data_editor` 可编辑表格，支持动态增删行
- 状态列：✅ / ❌ / ⚠️ 三态选择
- 坏习惯检测：扫描"原因"列，匹配 `texts.py` 中的关键词库后弹出告警
- 空任务保护：无任务时自动插入"此日未作安排"占位行

**2. 时间切片管理（Tab: 30分钟时间流）**
- 48 个半小时时间块（00:00-24:00），计划 vs 实际对比
- 时间段列锁定（`disabled=True`），防止误改
- 自动完成：`template.py` 中标记的固定任务（如睡眠）自动填充 ✅

**3. 量化数据 & 反思**
- 量化指标：心情评分(1-5)、睡眠评分(1-5)+入睡/起床时间+自动计算时长、番茄钟计数、静坐分钟、AI 使用时间、打飞机计数
- 结构化反思：10 个反思维度（AI使用、AI学习、阅读、静坐、善行、恶行、对自己说的话、所思所想、睡前与梦境、深度反思），定义在 `texts.py` 的 `REFLECTIONS_MAP` 中

### 模块 C：数据持久化
- **保存触发**：用户点击"💾 保存并生成日记"按钮
- **CSV 写入**：Upsert 模式写入三表（覆盖同日旧数据，不重复追加）
- **Markdown 生成**：保存后自动调用 `md_template.py` 模板，将当日数据填充生成 `.md` 日记成品
- **存储路径**：CSV 按年度分表存于 `BASE_DIR/data/`，Markdown 按月归档存于 `BASE_DIR/MM月/`

## 数据架构
- 三表设计：tasks_log（任务）、time_log（时间切片）、daily_summary（每日概览）
- 所有表以 Date (YYYY-MM-DD) 为主键关联
- 存储路径基于 `config.py` 中的 BASE_DIR，按年度分表、按月份归档

## 会话风格

### 角色定位：导师式协作
- 解释每个技术决策背后的**原因和权衡**，不只是给代码
- 遇到新技术概念时**主动教学**，帮助提升编程能力
- 从**产品和架构角度**分析问题，培养系统思维
- 主动分享**行业最佳实践**和常见陷阱

### 沟通规则
- 始终使用中文回答
- 回答时要有自己的独立思考，不只是执行指令
- 小改动直接执行，大改动或涉及架构的先讨论再动手
- 提出建议时说明利弊，但尊重用户最终决策

## 代码规范
- 变量名、函数名使用英文（snake_case）
- 注释、文档、commit message 使用中文
- 新增核心功能必须附带单元测试
- 遵循现有代码风格，保持一致性
- 不做未被要求的重构或优化

## 开发原则
- **本地优先**：所有数据存储在本地，隐私安全第一
- **读写分离**：CSV 存原始数据，Markdown 为最终展示层
- **以日期为轴**：所有数据操作围绕日期展开
- **Upsert 模式**：更新时覆盖同日期数据，不重复追加
- **商业化意识**：代码质量、可维护性、可扩展性要为未来做准备

## 当前阶段重点
- 完善现有核心功能的稳定性
- 修复已知 bug，优化用户体验
- 不急于加新功能，先把基础打扎实
